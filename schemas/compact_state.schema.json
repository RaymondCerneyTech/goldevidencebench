{
  "title": "CompactState",
  "type": "object",
  "required": [
    "schema_version",
    "artifact_version",
    "run_id",
    "run_dir",
    "updated_at",
    "current_goal",
    "constraints",
    "verified_facts",
    "open_questions",
    "run_config",
    "gates_enabled",
    "rerank_mode",
    "authority_mode",
    "last_known_good",
    "current_context_keys",
    "context_keys_digest"
  ],
  "properties": {
    "schema_version": { "type": "string" },
    "artifact_version": { "type": "string" },
    "run_id": { "type": "string" },
    "run_dir": { "type": "string" },
    "updated_at": { "type": "string" },
    "current_goal": { "type": "string" },
    "constraints": {
      "type": "array",
      "items": { "type": "string" }
    },
    "verified_facts": {
      "type": "array",
      "items": { "type": "object" }
    },
    "open_questions": {
      "type": "array",
      "items": { "type": "string" }
    },
    "run_config": { "type": "object" },
    "gates_enabled": { "type": "object" },
    "rerank_mode": { "type": ["string", "null"] },
    "authority_mode": { "type": ["string", "null"] },
    "last_known_good": {
      "type": "object",
      "required": ["summary", "diagnosis", "report", "gate_artifacts"],
      "properties": {
        "summary": { "type": ["string", "null"] },
        "diagnosis": { "type": ["string", "null"] },
        "report": { "type": ["string", "null"] },
        "gate_artifacts": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": true
    },
    "current_context_keys": {
      "type": "array",
      "items": { "type": "string" }
    },
    "context_keys_digest": { "type": "string" }
  },
  "additionalProperties": true
}
