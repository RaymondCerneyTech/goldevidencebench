{
  "version": "1.0",
  "notes": "Trap contract audit scoreboard. Add cells per trap as artifacts become available.",
  "include_release_families": {
    "enabled": true,
    "contract_path": "configs/release_gate_contract.json"
  },
  "defaults": {
    "min_on_expected_rate": 0.9,
    "min_off_expected_rate": 0.9,
    "min_runs_per_condition": 3,
    "max_on_score_stddev": 0.15,
    "max_off_score_stddev": 0.15,
    "min_adapter_pass_count": 1
  },
  "traps": [
    {
      "id": "stale_tab_state_drift",
      "description": "Drift trap should fail in baseline path and pass in fixed path.",
      "thresholds": {
        "min_runs_per_condition": 1,
        "max_on_score_stddev": 0.5,
        "max_off_score_stddev": 0.5,
        "min_adapter_pass_count": 1
      },
      "cells": [
        {
          "condition": "on",
          "adapter": "retrieval_llama_cpp_adapter",
          "path_glob": "runs/drift_holdout_compare_*/fix_prefer_set_latest/summary.json",
          "latest": 20,
          "expect": {
            "path": "drift.step_rate",
            "max": 0.25
          },
          "metric_path": "drift.step_rate"
        },
        {
          "condition": "off",
          "adapter": "retrieval_llama_cpp_adapter",
          "path_glob": "runs/drift_holdout_compare_*/baseline_latest_step/summary.json",
          "latest": 20,
          "expect": {
            "path": "drift.step_rate",
            "min": 0.5
          },
          "metric_path": "drift.step_rate"
        }
      ],
      "effect_check": {
        "on_metric_path": "drift.step_rate",
        "off_metric_path": "drift.step_rate",
        "direction": "off_minus_on",
        "min_delta": 0.2,
        "aggregate": "mean"
      },
      "collateral_checks": [
        {
          "id": "on_exact_acc_floor",
          "condition": "on",
          "path": "overall.exact_acc_mean",
          "aggregate": "mean",
          "min": 0.95
        }
      ]
    },
    {
      "id": "implication_coherence_hard_pack",
      "description": "Implication hard-pack holdout should sustain high inferred-contract accuracy while canary remains low.",
      "thresholds": {
        "min_runs_per_condition": 2,
        "min_on_expected_rate": 0.8,
        "min_off_expected_rate": 0.8,
        "max_on_score_stddev": 0.12,
        "max_off_score_stddev": 0.15,
        "min_adapter_pass_count": 1
      },
      "cells": [
        {
          "condition": "on",
          "adapter": "llama_server_adapter",
          "path_glob": "runs/implication_coherence_*_target_r*/implication_coherence_summary.json",
          "latest": 20,
          "expect": {
            "path": "holdout.means.hard_case_value_acc",
            "min": 0.75
          },
          "metric_path": "holdout.means.hard_case_value_acc"
        },
        {
          "condition": "off",
          "adapter": "llama_server_adapter",
          "path_glob": "runs/implication_coherence_*_target_r*/implication_coherence_summary.json",
          "latest": 20,
          "expect": {
            "path": "canary.means.exact_acc",
            "max": 0.25
          },
          "metric_path": "canary.means.exact_acc"
        }
      ],
      "effect_check": {
        "on_metric_path": "holdout.means.hard_case_value_acc",
        "off_metric_path": "canary.means.exact_acc",
        "direction": "on_minus_off",
        "min_delta": 0.55,
        "aggregate": "mean"
      },
      "collateral_checks": [
        {
          "id": "on_hard_case_count_floor",
          "condition": "on",
          "path": "holdout.means.hard_case_count",
          "aggregate": "mean",
          "min": 12
        },
        {
          "id": "on_value_acc_floor",
          "condition": "on",
          "path": "holdout.means.value_acc",
          "aggregate": "mean",
          "min": 0.85
        }
      ]
    }
  ]
}
